#  Fiber架构  
首先需要了解代数效应  

## 什么是代数效应？  
代数效应是函数式编程中的一个概念，用于将副作用从函数调用中分离。

## 代数效应在React中的应用？ 
Hooks  

## 代数效应与Generator  
从React15到React16，协调器（Reconciler）重构的一大目的是：将老的同步更新的架构变为异步可中断更新。

异步可中断更新可以理解为：更新在执行过程中可能会被打断（浏览器时间分片用尽或有更高优任务插队），当可以继续执行时恢复之前执行的中间状态。

这就是代数效应中try...handle的作用。

其实，浏览器原生就支持类似的实现，这就是``Generator``。

但是Generator的一些缺陷使React团队放弃了他：

类似async，Generator也是传染性的，使用了Generator则``上下文的其他函数也需要作出改变``。这样心智负担比较重。

Generator执行的中间状态是``上下文关联的``。

应为要考虑中断这一操作，如果使用``Generator``就需要保留上下文，会引入新的复杂度。  

基于这些原因，React没有采用Generator实现协调器  

## Fiber的含义
1. 作为架构来说，之前React15的Reconciler采用递归的方式执行，数据保存在递归调用栈中，所以被称为stack Reconciler。React16的Reconciler基于Fiber节点实现，被称为Fiber Reconciler。

2. 作为静态的数据结构来说，每个Fiber节点对应一个React element，保存了该组件的类型（函数组件/类组件/原生组件...）、对应的DOM节点等信息。

3. 作为动态的工作单元来说，每个Fiber节点保存了本次更新中该组件改变的状态、要执行的工作（需要被删除/被插入页面中/被更新...）。

## 什么是双缓存？  
当我们用canvas绘制动画，每一帧绘制前都会调用``ctx.clearRect``清除上一帧的画面。

如果当前帧画面计算量比较大，导致清除上一帧画面到绘制当前帧画面之间有较长间隙，就会出现白屏。

为了解决这个问题，我们可以在内存中绘制当前帧动画，绘制完毕后直接用当前帧替换上一帧画面，由于省去了两帧替换间的计算时间，不会出现从白屏到出现画面的闪烁情况。

``这种在内存中构建并直接替换的技术叫做双缓存`` 。

React使用“双缓存”来完成Fiber树的构建与替换——对应着DOM树的创建与更新。 

## 双缓存Fiber树  
大概意思就是先会生成一棵Fiber树，将这棵Fiber树和老的Fiber树进行比较，根据打的标记进行更新，然后将指针指向新的Fiber树进行替换



